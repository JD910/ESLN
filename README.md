# *LNHG* model for lung nodule segmentation and intra-nodular heterogeneity image generation

[![standard-readme compliant](https://img.shields.io/badge/Readme-standard-brightgreen.svg?style=flat-square)](https://github.com/JD910/LNHG/blob/main/README.md)
![](https://img.shields.io/badge/Pytorch-1.7.1-brightgreen.svg?style=flat-square)

This is the repository of *LNHG* model for end-to-end lung nodule segmentation and intra-nodular heterogeneity image generation.

<div align=left><img width="610" height="300" src="https://github.com/JD910/LNHG/blob/main/Segmentation/Images/Fig2-New.jpg"/></div><br />


## Segmentation branch using WGAN-GP for lung nodule segmentation and intra-nodular heterogeneity map production
### 
**Input: Volumes consisted of continuous CT images of the same nodule (Channel, Depth, H, W)**<br />
**Output: The corresponding lung nodule images (Channel, Depth, H, W)**<br />
* Train.py is used to start the training of the WGAN-GP branch.<br />
* Unet_Comparison.py is the model of the U-net for comparison.

## False-positive reduction branch using Faster R-CNN with GIoU loss<br />
### 
**Input:  Original CT images (H, W)**<br />
**Output: CT images of corresponding nodule candidates (H, W)**<br />

* train.py is used to start the training and validation of the Faster R-CNN branch.<br />
* The [```_smooth_l1_loss()```](https://github.com/JD910/LNHG/blob/main/Detection/trainer.py#L112) and the GIoU loss are provided in the same function to calculate the location loss for better understanding. <br/>

## Example illustrating how the final lung nodule image is produced
<div align=left><img width="650" height="358" src="https://github.com/JD910/LNHG/blob/main/Segmentation/Images/Fig-github.jpg"/></div><br />

**Example illustrating how the final lung nodule image is produced based on the output of WGAN-GP and Faster R-CNN branches. The false-positive candidates produced by the WGAN-GP branch is marked in a red oval for better display. By fusing the output of the two branches, the false-positive candidates are eliminated, and the final lung nodule image is produced.**<br />

## Intra-nodular heterogeneity image of benign and malignancy nodules
<div align=left><img width="700" height="286" src="https://github.com/JD910/LNHG/blob/main/Segmentation/Images/Benign and malignant.jpg"/></div><br />

**Illustration of the intra-nodular heterogeneity images. Intra-nodular heterogeneous activity is presented, and the other area is displayed in the original CT image. The images in the first row denote the pathologically confirmed benign nodules, and the second row shows lung nodules diagnosed as malignant by pathology. Significant difference on intra-nodular heterogeneous activity between the benign and malignant lung nodules could be found according to the images generated by the proposed *LNHG* model.**<br />
